tosca_definitions_version: cloudify_dsl_1_3

imports:
  - http://www.getcloudify.org/spec/cloudify/4.0/types.yaml
  - https://raw.githubusercontent.com/cloudify-incubator/cloudify-utilities-plugin/v1.0.0/plugin.yaml
  - aws/deployment-proxy-inputs.yaml
  - aws/compute-blueprint.yaml
  - consul/consul-blueprint.yaml

node_templates:

  environment_dep:
    type: cloudify.nodes.BlueprintDeployment
    properties:
      resource_config:
        application_file_name: { get_input: environment_blueprint_filename }
        blueprint_archive: { get_input: environment_blueprint }
        inputs: { get_input: environment_inputs }

  environment:
    type: cloudify.nodes.DeploymentProxy
    properties:
      resource_config:
        deployment_id: { get_attribute: [ environment_dep, deployment, id ] }
        outputs:
          public_subnet_id: public_subnet_id
          private_subnet_id: private_subnet_id
          ssh_group_id: ssh_group_id
          key_path: key_path
          key_name: key_name
          availability_zone: availability_zone
          region_name: region_name
          region_endpoint: region_endpoint
    relationships:
      - type: cloudify.relationships.depends_on
        target: environment_dep
